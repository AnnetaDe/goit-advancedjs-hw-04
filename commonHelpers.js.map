{"version":3,"file":"commonHelpers.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js"],"sourcesContent":["export * from \"./pixabay-api.js\";\n\n// lib imports\nimport axios from \"axios\";\nimport flatpickr from \"flatpickr\";\nimport iziToast from \"izitoast\";\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\n\nconst API_KEY = \"3024031-50bf2ca6b1e9bc3513f045fb3\";\n\nexport async function getImages(query, page) {\n  let currentPage = 1;\n  let qtyPerPage = 15;\n  const searchParams = new URLSearchParams({\n    key: API_KEY,\n    q: query,\n    image_type: \"photo\",\n    orientation: \"horizontal\",\n    safesearch: \"true\",\n    per_page: qtyPerPage,\n    page\n  });\n  const baseUrl = `https://pixabay.com/api/?${searchParams.toString()}`;\n  return axios.get(baseUrl);\n}\n\n\n","export * from \"./render-functions.js\";\n\n// library imports\n// import axios from \"axios\"; // Remove unused import\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\nimport iziToast from \"izitoast\";\n\n// function imports\nimport { getImages } from \"./pixabay-api.js\";\n\n// local variables\nconst searchForm = document.querySelector(\".form\");\nconst galleryEl = document.querySelector(\".gallery\");\nconst loaderEl = document.querySelector(\".loader\");\nconst loadMoreImagesBtn = document.querySelector(\".load-more-images-btn\");\nconst userInput = document.querySelector(\"#user-search-input\");\nloadMoreImagesBtn.classList.add(\"is-hidden\");\nlet query = \"\";\nlet currentPage = 1;\n\nconst scroll = () => {\n  const scroll = document.querySelector(\".bottom-scroll\");\n  scroll.scrollIntoView({\n    behavior: \"smooth\"\n  });\n};\n\nconst scrollUp = () => {\n  const scroll = document.querySelector(\".top-scroll\");\n  scroll.scrollIntoView({\n    behavior: \"smooth\"\n  });\n};\n\nconst getLightbox = (linkClass) => new SimpleLightbox(linkClass, {\n  focus: true,\n  captionsData: \"alt\",\n  captionDelay: 250\n});\n\nfunction renderItemsMarkup(hits) {\n  const galleryItemsMarkup = hits\n    .map(hit => {\n      return `\n    <li class=\"gallery-item\">\n    <div class=\"img-container\">\n          <a  class=\"image-link\" href=\"${hit.largeImageURL}\"><img class=\"image\" src=\"${hit.webformatURL}\" alt=\"${hit.tags}\" />\n          </div>\n          <ul class=\"under-picture-list\">\n              <li class=\"under-picture-info-item\">Likes <span class=\"data-received\">${hit.likes}</span></li>\n              <li class=\"under-picture-info-item\">Views <span class=\"data-received\">${hit.views}</span></li>\n              <li class=\"under-picture-info-item\">Comments <span class=\"data-received\">${hit.comments}</span></li>\n              <li class=\"under-picture-info-item\">Downloads <span class=\"data-received\">${hit.downloads}</span></li>\n          </ul>\n      </li> \n      </a>`;\n    })\n    .join(\"\");\n  return galleryItemsMarkup;\n}\n\nconst removeLoadMoreBtn = () => {\n  loadMoreImagesBtn.classList.add(\"is-hidden\");\n  loadMoreImagesBtn.removeEventListener(\"click\", onLoadMoreBtnClick);\n};\n\nconst showLoadMoreBtn = () => {\n  loadMoreImagesBtn.classList.remove(\"is-hidden\");\n  loadMoreImagesBtn.addEventListener(\"click\", onLoadMoreBtnClick);\n};\nconst refreshGallery = (searchForm, errorMessage) => {\n  galleryEl.innerHTML = \"\";\n  searchForm.reset();\n  iziToast.error({\n    message: errorMessage,\n    position: \"topRight\",\n    timeout: 2000\n  });\n  removeLoadMoreBtn();\n};\n\n\nconst onLoadMoreBtnClick = async event => {\n  try {\n    currentPage += 1;\n    const response = await getImages(query, currentPage);\n    galleryEl.insertAdjacentHTML(\n      \"beforeend\",\n      renderItemsMarkup(response.data.hits)\n    );\n    let lightbox = getLightbox(\".image-link\");\n    lightbox.refresh();\n   \n    scroll();\n\n    let totalPages = Math.ceil(response.data.totalHits / 15);\n\n    if (currentPage === totalPages ) {\n      removeLoadMoreBtn();\n      iziToast.warning({\n        message: \"We're sorry, but you've reached the end of search results.\",\n        position: \"topRight\"\n      });\n      \n      setTimeout(() => {\n        scrollUp();\n      }, 5000);\n      \n    }\n    \n     loaderEl.classList.remove(\"is-visible\");\n    \n  } catch (error) {\n   \n    console.log(error);\n  }\n};\n\n\nconst onSearchFormSubmit = async event => {\n  try {\n    event.preventDefault();\n    query = event.target.elements.picture_search.value.trim();  \n    if (query === \"\") {\n      refreshGallery(event.target, \"Please enter a query.\");\n      return;\n    }\n    currentPage = 1;\n    galleryEl.innerHTML = \"\";\n    loaderEl.classList.add(\"is-visible\");\n    const response = await getImages(query, currentPage);\n    loaderEl.classList.remove(\"is-visible\");\n    userInput.value = \"\";\n\n    if (response.data.hits.length === 0) {\n      refreshGallery(\n        event.target,\n       iziToast.error({\n          message: \"Sorry, there are no images matching your search query. Please try again.\",\n        })\n      );\n      return;\n    }\n    galleryEl.insertAdjacentHTML(\n        \"beforeend\",\n        renderItemsMarkup(response.data.hits)\n      );\n      let lightbox=getLightbox(\".image-link\");\n      lightbox.refresh();\n\n    if (response.data.totalHits <= 15) {\n      removeLoadMoreBtn();\n      return;\n    }\n\n    if (response.data.totalHits > 15) {\n      galleryEl.innerHTML = renderItemsMarkup(response.data.hits);\n      lightbox.refresh();\n      showLoadMoreBtn();\n      loadMoreImagesBtn.addEventListener(\"click\", onLoadMoreBtnClick);\n      scroll();\n    }\n   \n  } catch (error) {\n    loaderEl.classList.remove(\"is-visible\");\n    console.log(error);\n  }\n};\n\n\nsearchForm.addEventListener(\"submit\", onSearchFormSubmit);\nsearchForm.addEventListener(\"reset\", () => {\n  galleryEl.innerHTML = \"\";\n  removeLoadMoreBtn();\n  iziToast.info({\n    message: \"Search reset. Please enter a new query.\",\n    position: \"topRight\"\n  });\n});"],"names":["API_KEY","getImages","query","page","qtyPerPage","baseUrl","axios","searchForm","galleryEl","loaderEl","loadMoreImagesBtn","userInput","currentPage","scroll","scrollUp","getLightbox","linkClass","SimpleLightbox","renderItemsMarkup","hits","hit","removeLoadMoreBtn","onLoadMoreBtnClick","showLoadMoreBtn","refreshGallery","errorMessage","iziToast","event","response","totalPages","error","onSearchFormSubmit","lightbox"],"mappings":"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"}