{"version":3,"file":"commonHelpers.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js"],"sourcesContent":["export * from \"./pixabay-api.js\";\n\n// lib imports\nimport axios from \"axios\";\nimport flatpickr from \"flatpickr\";\nimport iziToast from \"izitoast\";\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\n\nconst API_KEY = \"3024031-50bf2ca6b1e9bc3513f045fb3\";\n\nexport async function getImages(query, page) {\n  let currentPage = 1;\n  let qtyPerPage = 15;\n  const searchParams = new URLSearchParams({\n    key: API_KEY,\n    q: query,\n    image_type: \"photo\",\n    orientation: \"horizontal\",\n    safesearch: \"true\",\n    per_page: qtyPerPage,\n    page\n  });\n  const baseUrl = `https://pixabay.com/api/?${searchParams.toString()}`;\n  return axios.get(baseUrl);\n}\n\n\n","export * from \"./render-functions.js\";\n\n// library imports\n// import axios from \"axios\"; // Remove unused import\n\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\nimport iziToast from \"izitoast\";\n\n// function imports\nimport { getImages } from \"./pixabay-api.js\";\nimport simpleLightbox from \"simplelightbox\";\n\n// local variables\nconst searchForm = document.querySelector(\".search-form\");\nconst galleryEl = document.querySelector(\".picture-and-data-list\");\nconst pictureCard = document.querySelector(\".picture-and-data-item\");\nconst loaderEl = document.querySelector(\".loader\");\nconst loadMoreImagesBtn = document.querySelector(\".load-more-images-btn\");\nconst userInput = document.querySelector(\"#user-search-input\");\nloadMoreImagesBtn.classList.add(\"is-hidden\");\nlet query = \"\";\nlet currentPage = 1;\n\nconst scroll = () => {\n  const scroll = document.querySelector(\".bottom-scroll\");\n  scroll.scrollIntoView({\n    behavior: \"smooth\"\n  });\n};\n\nconst scrollUp = () => {\n  const scroll = document.querySelector(\".top-scroll\");\n  scroll.scrollIntoView({\n    behavior: \"smooth\"\n  });\n};\n\nconst lightbox = new SimpleLightbox(\".image-link\", {\n  focus: true,\n  captionsData: \"alt\",\n  captionDelay: 250\n});\n\nfunction renderItemsMarkup(hits) {\n  const galleryItemsMarkup = hits\n    .map(hit => {\n      return `\n    <li class=\"picture-and-data-item\">\n    <div class=\"img-container\">\n          <a  class=\"image-link\" href=\"${hit.largeImageURL}\"><img class=\"image\" src=\"${hit.webformatURL}\" alt=\"${hit.tags}\" />\n          </div>\n          <ul class=\"under-picture-list\">\n              <li class=\"under-picture-info-item\">Likes <span class=\"data-received\">${hit.likes}</span></li>\n              <li class=\"under-picture-info-item\">Views <span class=\"data-received\">${hit.views}</span></li>\n              <li class=\"under-picture-info-item\">Comments <span class=\"data-received\">${hit.comments}</span></li>\n              <li class=\"under-picture-info-item\">Downloads <span class=\"data-received\">${hit.downloads}</span></li>\n          </ul>\n      </li> \n      </a>`;\n    })\n    .join(\"\");\n  return galleryItemsMarkup;\n}\n\nconst removeLoadMoreBtn = () => {\n  loadMoreImagesBtn.classList.add(\"is-hidden\");\n  loadMoreImagesBtn.removeEventListener(\"click\", onLoadMoreBtnClick);\n};\n\nconst showLoadMoreBtn = () => {\n  loadMoreImagesBtn.classList.remove(\"is-hidden\");\n  loadMoreImagesBtn.addEventListener(\"click\", onLoadMoreBtnClick);\n};\nconst refreshGallery = (searchForm, errorMessage) => {\n  galleryEl.innerHTML = \"\";\n\n  searchForm.reset();\n\n  iziToast.error({\n    message: errorMessage,\n    position: \"topRight\",\n    timeout: 2000\n  });\n\n  removeLoadMoreBtn();\n};\n\nconst onSearchFormSubmit = async event => {\n  try {\n    event.preventDefault();\n    query = event.target.elements.picture_search.value.trim();\n    currentPage = 1;\n    \n    const lightbox = new SimpleLightbox(\".image-link\", {\n      focus: true,\n      captionsData: \"alt\",\n      captionDelay: 250\n    });\n    if (query === \"\") {\n      refreshGallery(event.target, \"Please enter a query.\");\n      return;\n    }\n    galleryEl.innerHTML = \"\";\n    loaderEl.classList.add(\"is-visible\");\n    const response = await getImages(query, currentPage);\n    loaderEl.classList.remove(\"is-visible\");\n    userInput.value = \"\";\n\n    if (response.data.hits.length === 0) {\n      refreshGallery(\n        event.target,\n        \"No images found. Please enter another query.\"\n      );\n      \n      return;\n    }\n\n    if (response.data.totalHits <= 15) {\n      galleryEl.insertAdjacentHTML(\n        \"beforeend\",\n        renderItemsMarkup(response.data.hits)\n      );\n      lightbox.refresh();\n      removeLoadMoreBtn();\n      iziToast.warning({\n        message: \"We're sorry, but you've reached the end of search results.\",\n        position: \"topRight\",});\n      return;\n    }\n\n    if (response.data.totalHits > 15) {\n      galleryEl.innerHTML = renderItemsMarkup(response.data.hits);\n      lightbox.refresh();\n      showLoadMoreBtn();\n      loadMoreImagesBtn.addEventListener(\"click\", onLoadMoreBtnClick);\n      scroll();\n    }\n   \n  } catch (error) {\n    loaderEl.classList.remove(\"is-visible\");\n    console.log(error);\n  }\n};\n\nconst onLoadMoreBtnClick = async event => {\n  try {\n    currentPage += 1;\n    const response = await getImages(query, currentPage);\n    galleryEl.insertAdjacentHTML(\n      \"beforeend\",\n      renderItemsMarkup(response.data.hits)\n    );\n    new SimpleLightbox(\".image-link\", {\n      focus: true,\n      captionsData: \"alt\",\n      captionDelay: 250\n    });\n   \n    scroll();\n\n    let totalPages = Math.ceil(response.data.totalHits / 15);\n\n    if (currentPage === totalPages ) {\n      removeLoadMoreBtn();\n      iziToast.warning({\n        message: \"We're sorry, but you've reached the end of search results.\",\n        position: \"topRight\"\n      });\n      \n      setTimeout(() => {\n        scrollUp();\n      }, 5000);\n      \n    }\n    \n     loaderEl.classList.remove(\"is-visible\");\n    \n  } catch (error) {\n   \n    console.log(error);\n  }\n};\n\nsearchForm.addEventListener(\"submit\", onSearchFormSubmit);\n\n\n"],"names":["API_KEY","getImages","query","page","qtyPerPage","baseUrl","axios","searchForm","galleryEl","loaderEl","loadMoreImagesBtn","userInput","currentPage","scroll","scrollUp","SimpleLightbox","renderItemsMarkup","hits","hit","removeLoadMoreBtn","onLoadMoreBtnClick","showLoadMoreBtn","refreshGallery","errorMessage","iziToast","onSearchFormSubmit","event","lightbox","response","error","totalPages"],"mappings":"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"}